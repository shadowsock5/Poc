- [Shiro反序列化漏洞笔记五（对抗篇）](http://changxia3.com/2022/05/09/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0%E4%BA%94%EF%BC%88%E5%AF%B9%E6%8A%97%E7%AF%87%EF%BC%89/)


> Shiro对于rememberMe的解密流程简单概括大致为：先对rememberMe进行Base64解码，然后再进行AES解密。下断点分析一下rememberMe的解密流程不难发现一个比较有意思的地方，Shiro对于rememberMe的Base64解密是自实现的代码。


> 在Base64解密之前先判断是否存在非Base64编码字符集的字符。


> 如果存在非Base64编码字符集的字符，会丢弃字符。确保最后剩下的都是Base64编码字符集的字符最后再进行Base64解码。

> 既然这样的话，那我们在rememberMe的值里面插入非Base64编码字符集的字符不就可以干扰防护产品对rememberMe进行解密处理了么，如果Base64解码不成功的话，后面的AES解密自然也会失败。理论上只要插入任意的非Base64编码字符都可以，无论是可见字符还是不可见字符，但是实际上还要考虑一个问题，就是插入的字符确保也要能正常被中间件先解析，要不然的话也是不行的,符合这样的条件的字符是很多的，如：!、#、$、%、&、’、(、)、.、[、]、\xeb、\xec、\xed、\xee、\xef、\xf0、\xf1等等。
